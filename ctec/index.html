<!DOCTYPE html>
<html>
    <head>
        <title>CTEC - Cell Transfection Efficiency Calculator</title>
		<meta charset="UTF-8">
        <link rel="stylesheet" href="./style.css">
        <link rel="stylesheet" href="./style-dark.css" id="dark-style"><script src="https://twgljs.org/dist/3.x/twgl.min.js"></script>
        <script id="vs-def" type="x-shader/x-vertex">
            precision highp float;

            attribute vec2 a_pos;
            attribute vec2 a_tex_coord;
            
            uniform vec2 u_res;
            
            varying vec2 v_tex_coord;
            
            void main() {
                vec2 zero_to_one = a_pos / u_res;
                vec2 zero_to_two = zero_to_one * 2.0;
                vec2 clip_space = zero_to_two - 1.0;
                
                gl_Position = vec4(clip_space * vec2(1, -1), 0, 1);

                v_tex_coord = a_tex_coord;
            }
        </script>
        <script id="fs-def" type="x-shader/x-fragment">
            precision highp float;

            uniform vec2 u_res;
            uniform sampler2D u_canvas;
        
            varying vec2 v_tex_coord;
        
            void main() {
                vec4 color = texture2D(u_canvas, v_tex_coord);

                gl_FragColor = color;
            }
        </script>
        <script id="fs-1" type="x-shader/x-fragment">
            precision highp float;

            uniform vec2 u_res;
            uniform sampler2D u_canvas;

            uniform vec3 u_mult;
        
            varying vec2 v_tex_coord;
        
            void main() {
                vec4 color = texture2D(u_canvas, v_tex_coord);

                gl_FragColor = color * vec4(u_mult, 1.0);
            }
        </script>
        <script id="fs-2" type="x-shader/x-fragment">
            precision highp float;

            uniform vec2 u_res;
            uniform sampler2D u_canvas;

            uniform vec3 u_mult;
            const vec2 u_sample = vec2(15.0, 15.0);
            uniform vec3 u_max;
            uniform vec3 u_bright;
            uniform vec3 u_weight;
            uniform vec3 u_pow;
        
            varying vec2 v_tex_coord;
        
            void main() {
                vec2 tex_coord = v_tex_coord * u_res;
                vec4 color = texture2D(u_canvas, v_tex_coord);

                float w = (min(v_tex_coord.x + u_sample.x, u_res.x) - max(v_tex_coord.x - u_sample.x, 0.0));
                float h = (min(v_tex_coord.y + u_sample.y, u_res.y) - max(v_tex_coord.y - u_sample.y, 0.0));
                float n_pix = w * h;
                vec4 avg_color = vec4(0.0, 0.0, 0.0, 0.0);
                for (float x = -u_sample.x; x <= u_sample.x; x++) {
                    for (float y = -u_sample.y; y <= u_sample.y; y++) {
                        vec2 offset = vec2(x, y) / u_res;
                        avg_color += texture2D(u_canvas, v_tex_coord + offset) / n_pix;
                    }
                }
                float r = min(u_max.r, mix(avg_color.r, 1.0, float(avg_color.r == 0.0))) / u_bright.r;
                float g = min(u_max.g, mix(avg_color.g, 1.0, float(avg_color.g == 0.0))) / u_bright.g;
                float b = min(u_max.b, mix(avg_color.b, 1.0, float(avg_color.b == 0.0))) / u_bright.b;
                color = mix(color, color / vec4(r, g, b, 1.0), vec4(u_weight, 1.0));
                color = pow(color, vec4(u_pow, 1.0));

                gl_FragColor = color * vec4(u_mult, 1.0);
            }
        </script>
        <script id="fs-3" type="x-shader/x-fragment">
            precision highp float;

            uniform vec2 u_res;
            uniform sampler2D u_canvas;

            uniform vec3 u_mult;
            const vec2 u_sample = vec2(15.0, 15.0);
            uniform vec3 u_max;
            uniform vec3 u_bright;
            uniform vec3 u_weight;
            uniform vec3 u_pow;
            uniform vec3 u_thresh;
        
            varying vec2 v_tex_coord;
        
            void main() {
                vec2 tex_coord = v_tex_coord * u_res;
                vec4 color = texture2D(u_canvas, v_tex_coord);

                float w = (min(v_tex_coord.x + u_sample.x, u_res.x) - max(v_tex_coord.x - u_sample.x, 0.0));
                float h = (min(v_tex_coord.y + u_sample.y, u_res.y) - max(v_tex_coord.y - u_sample.y, 0.0));
                float n_pix = w * h;
                vec4 avg_color = vec4(0.0, 0.0, 0.0, 0.0);
                for (float x = -u_sample.x; x <= u_sample.x; x++) {
                    for (float y = -u_sample.y; y <= u_sample.y; y++) {
                        vec2 offset = vec2(x, y) / u_res;
                        avg_color += texture2D(u_canvas, v_tex_coord + offset) / n_pix;
                    }
                }
                float r = min(u_max.r, mix(avg_color.r, 1.0, float(avg_color.r == 0.0))) / u_bright.r;
                float g = min(u_max.g, mix(avg_color.g, 1.0, float(avg_color.g == 0.0))) / u_bright.g;
                float b = min(u_max.b, mix(avg_color.b, 1.0, float(avg_color.b == 0.0))) / u_bright.b;
                color = mix(color, color / vec4(r, g, b, 1.0), vec4(u_weight, 1.0));
                color = pow(color, vec4(u_pow, 1.0));
                color.r = float(color.r > u_thresh.r);
                color.g = float(color.g > u_thresh.g);
                color.b = float(color.b > u_thresh.b);

                gl_FragColor = color * vec4(u_mult, 1.0);
            }
        </script>
        <script src="./UTIF.js"></script>
        <script type="module">
            import App from "./app.js";
			const app = new App();
			app.start();
        </script>
    </head>
    <body>
        <header>
            <button class="logo">CTEC</button>
            <button class="name">Cell Transfection Efficiency Calculator</button>
            <span class="spacer"></span>
            <button class="about">About</button>
            <button class="theme"><ion-icon name="sunny"></ion-icon></button>
            <div class="theme-dropdown">
                <button class="light"><ion-icon name="sunny"></ion-icon><span>Light</span></button>
                <button class="dark"><ion-icon name="moon"></ion-icon><span>Dark</span></button>
                <button class="system"><ion-icon name="cloudy"></ion-icon><span>System</span></button>
            </div>
        </header>
        <article class="intro">
            <article class="intro-card">
                <h1>Upload an image to calculate its transfection efficiency</h1>
                <button>Upload manually</button>
                <span>or drag and drop</span>
            </article>
        </article>
        <article class="images-body">
            <article class="viewer">
                <article>
                    <article class="image">
                        <canvas width="0" height="0"></canvas>
                        <canvas width="0" height="0"></canvas>
                        <span>Click to enlarge</span>
                    </article>
                    <article class="editor">
                        <h1><span>1.</span><span>Input Configuration</span></h1>
                        <span class="channels">
                            <button class="r">Red</button>
                            <button class="g">Green</button>
                            <button class="b">Blue</button>
                        </span>
                    </article>
                </article>
            </article>
            <article class="navigator">
                <button class="add">
                    <ion-icon name="add"></ion-icon>
                </button>
            </article>
        </article>
        <div class="drag-overlay">
            <h1>Drop anywhere</h1>
            <div class="t l"></div>
            <div class="t r"></div>
            <div class="b l"></div>
            <div class="b r"></div>
        </div>
        <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
        <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    </body>
</html>